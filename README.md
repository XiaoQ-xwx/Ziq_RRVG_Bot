# 籽青 (Ziqing) - Telegram 群组媒体沉淀与分发助理

本工具是一个专为 Telegram 超级群组 (Supergroup) 及其话题 (Topics) 功能打造的媒体收集与分发机器人。基于 Cloudflare Workers + D1 数据库构建，完全 Serverless 化，零服务器成本，为您提供安全、私密且极其顺滑的群组图库管理体验。

## 注意！！！！

本项目99%都由AI编写
使用的模型为：Google Gemini Pro

## ✨ 核心特性

- **⚡ 极简自动化部署**
  部署后只需在浏览器中访问一次 Worker 域名，系统将全自动完成 D1 数据库建表、字段无感升级以及 Telegram Webhook 的注册绑定，免除一切手动配置烦恼。
- **🏷️ 高度自由的自定义分类**
  不再局限于预设类型！在任意群组话题中发送 `/bind <自定义分类名>`（例如 `/bind 动漫`、`/bind 梗图`），系统会自动将该话题指定为对应图库的数据源。
- **🔒 极度严苛的隐私与群组隔离**
  - **物理隔离**：不同群组的数据及设置表完全独立，互不干扰。
  - **私聊实时查岗**：仅允许群成员在私聊中查看其所在群组的图库。每次抽取前实时核验身份，退群瞬间权限自动剥夺。
- **🏥 智能失效检测与自动愈合**
  针对 Telegram 撤回消息导致的死链问题，独创被动体检机制：抽取到失效图库时将在底层自动剔除并重试；遇到群组解散或机器人被踢出等极端情况，将自动触发“连坐清理”，瞬间清空失效群组的所有关联数据。

## 🚀 部署指南

### 1. 准备工作
- 前往 Telegram 联系 [@BotFather](https://t.me/BotFather) 获取 **Bot Token**。
- 将 Bot 邀请至你的目标群组，并**给予管理员权限**。

### 2. Cloudflare 环境配置
- 创建一个新的 Cloudflare Worker。
- 创建一个 D1 数据库，并在 Worker 的 `Integrations` 中绑定，变量名必须填写为 `D1`。
- 在 Worker 的 `Variables and Secrets` 中添加以下环境变量：
  - `BOT_TOKEN_ENV`: 你的 Telegram Bot Token。
  - `ADMIN_SECRET`: (可选) 自定义密钥，用于外部 Python 脚本导入数据时的安全校验。

### 3. 一键初始化
将代码部署至 Worker 后，在浏览器中直接访问你的 Worker 域名（如 `https://your-worker.your-subdomain.workers.dev/`）。页面提示“部署大成功”即代表 Webhook 与数据库已自动就绪。

## 📖 指令列表

- `/start` - 呼出主控制面板（包含随机抽取、排行榜、收藏夹与独立设置）。
- `/help` - 调出说明书。
- `/bind <分类名>` - (限管理员) 将当前话题绑定为对应分类的采集库。
- `/bind_output` - (限管理员) 将当前话题设为群内的专属推送展示窗口。
- `/import_json` - 查看导入历史数据的帮助信息。

## 📥 历史数据导入

系统支持两种历史数据迁入方式：

1. **内置直导 (适合 5MB 以内文件)**：
   直接在群内向机器人发送导出的 JSON 文件，并在消息配文中附带 `/import <分类名>` 指令，机器人会自动解析并入库。
2. **外部 Python 脚本 (适合超大库，无限制)**：
   使用项目配套的 `import_history.py` 脚本，在本地进行分批切割推送，绕过 Worker 内存与时长限制（详见脚本内注释）。
